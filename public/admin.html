<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Email Validation System</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 1rem;
        }
        
        .jobs-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .jobs-table th,
        .jobs-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .jobs-table th {
            background-color: #f5f7fa;
            font-weight: 600;
        }
        
        .jobs-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .refresh-btn {
            background-color: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .refresh-btn:hover {
            background-color: #1976d2;
        }
        
        .job-id-link {
            color: #667eea;
            text-decoration: none;
        }
        
        .job-id-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Admin Dashboard</h1>
            <p>Email Validation System Monitoring</p>
        </header>

        <main>
            <div class="dashboard-header">
                <h2>System Overview</h2>
                <button id="refresh-dashboard" class="refresh-btn">Refresh Data</button>
            </div>
            
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-label">Total Jobs</div>
                    <div class="stat-value" id="total-jobs">0</div>
                    <div class="stat-label">All time</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Active Jobs</div>
                    <div class="stat-value" id="active-jobs">0</div>
                    <div class="stat-label">Currently processing</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Completed Jobs</div>
                    <div class="stat-value" id="completed-jobs">0</div>
                    <div class="stat-label">Successfully finished</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Failed Jobs</div>
                    <div class="stat-value" id="failed-jobs">0</div>
                    <div class="stat-label">Errors encountered</div>
                </div>
            </div>
            
            <h2>Recent Jobs</h2>
            <table class="jobs-table">
                <thead>
                    <tr>
                        <th>Job ID</th>
                        <th>Status</th>
                        <th>Total Emails</th>
                        <th>Completed</th>
                        <th>Progress</th>
                        <th>Created</th>
                        <th>Finished</th>
                    </tr>
                </thead>
                <tbody id="jobs-table-body">
                    <tr>
                        <td colspan="7" style="text-align: center;">No jobs found</td>
                    </tr>
                </tbody>
            </table>
        </main>

        <footer>
            <p>Email Validation System Admin Dashboard &copy; 2025</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const refreshBtn = document.getElementById('refresh-dashboard');
        const jobsTableBody = document.getElementById('jobs-table-body');
        
        // Update stats from API
        async function updateStats() {
            try {
                const response = await fetch('/api/stats');
                if (!response.ok) {
                    throw new Error('Failed to fetch stats');
                }
                const stats = await response.json();
                
                document.getElementById('total-jobs').textContent = stats.totalJobs;
                document.getElementById('active-jobs').textContent = stats.activeJobs;
                document.getElementById('completed-jobs').textContent = stats.completedJobs;
                document.getElementById('failed-jobs').textContent = stats.failedJobs;
            } catch (error) {
                console.error('Error fetching stats:', error);
            }
        }
        
        // Update jobs table from API
        async function updateJobsTable() {
            try {
                const response = await fetch('/api/jobs');
                if (!response.ok) {
                    throw new Error('Failed to fetch jobs');
                }
                const jobs = await response.json();
                
                if (jobs.length === 0) {
                    jobsTableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No jobs found</td></tr>';
                    return;
                }
                
                let jobsHtml = '';
                
                jobs.forEach(job => {
                    const progress = job.total > 0 ? Math.round((job.completed / job.total) * 100) : 0;
                    const createdDate = new Date(job.createdAt).toLocaleString();
                    const finishedDate = job.finishedAt ? new Date(job.finishedAt).toLocaleString() : '-';
                    
                    jobsHtml += `
                        <tr>
                            <td><a href="#" class="job-id-link" data-job-id="${job.id}">${job.id.substring(0, 8)}...</a></td>
                            <td><span class="status-badge ${job.status}">${job.status}</span></td>
                            <td>${job.total || 0}</td>
                            <td>${job.completed || 0}</td>
                            <td>
                                <div style="display: flex; align-items: center;">
                                    <div style="width: 100px; height: 8px; background-color: #e0e0e0; border-radius: 4px; margin-right: 10px;">
                                        <div style="width: ${progress}%; height: 100%; background-color: #667eea; border-radius: 4px;"></div>
                                    </div>
                                    <span>${progress}%</span>
                                </div>
                            </td>
                            <td>${createdDate}</td>
                            <td>${finishedDate}</td>
                        </tr>
                    `;
                });
                
                jobsTableBody.innerHTML = jobsHtml;
                
                // Add click handlers for job ID links
                document.querySelectorAll('.job-id-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const jobId = e.target.getAttribute('data-job-id');
                        // In a real implementation, this could redirect to a job details page
                        alert(`Job ID: ${jobId}\nIn a full implementation, this would show job details.`);
                    });
                });
            } catch (error) {
                console.error('Error fetching jobs:', error);
                jobsTableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Error loading jobs</td></tr>';
            }
        }
        
        // Refresh dashboard data
        async function refreshDashboard() {
            await updateStats();
            await updateJobsTable();
        }
        
        // Event Listeners
        refreshBtn.addEventListener('click', refreshDashboard);
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            refreshDashboard();
            // Auto-refresh every 30 seconds
            setInterval(refreshDashboard, 30000);
        });
    </script>
</body>
</html>